<!DOCTYPE html>
<html>
<head>
    <title>Posts</title>
</head>
<body>
<h2>Posts</h2>

<h3>Create Post</h3>
<input type="number" id="userId" placeholder="User ID">
<input type="text" id="title" placeholder="Title">
<input type="text" id="content" placeholder="Content">
<button onclick="createPost()">Create Post</button>

<h3>All Posts</h3>
<button onclick="getPosts()">Load Posts</button>
<ul id="postList"></ul>

<script>
async function createPost() {
    const userId = document.getElementById("userId").value;
    const title = document.getElementById("title").value;
    const content = document.getElementById("content").value;

    const res = await fetch(`/api/posts/user/${userId}`, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({title, content})
    });
    const data = await res.json();
    alert("Post created with ID: " + data.id);
    getPosts();
}

async function getPosts() {
    const res = await fetch("/api/posts");
    const posts = await res.json();

    const ul = document.getElementById("postList");
    ul.innerHTML = "";

    posts.forEach(post => {

        const li = document.createElement("li");
        li.innerHTML = `<strong>${post.title}</strong> - by ${post.user.name}`;

        // Create comments list
        if (post.comments && post.comments.length > 0) {
            const commentUl = document.createElement("ul");

            post.comments.forEach(comment => {
                const commentLi = document.createElement("li");
                commentLi.innerText = comment.message;
                commentUl.appendChild(commentLi);
            });

            li.appendChild(commentUl);
        }

        ul.appendChild(li);
    });
}

</script>

</body>
</html>